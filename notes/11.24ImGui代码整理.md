# 11.24ImGui代码整理

一、ImGuiLayer重构

删除了OnEvent和所有事件相关方法；把原本的OnUpdate方法拆分成了

void BeginImGui();
void OnImGuiRender();
void EndImGui();

BeginImGui创建ImGui的新帧；

OnImGuiRender决定需要渲染的窗口；

EndImGui调用ImGui渲染方法 & 设置Imgui的停靠功能和视窗。

二、优化主循环流程

```
void Application::OnUpdate()
{
	// 层栈的逻辑更新处理，由底层至顶层
	for (Layer* layer : m_LayerStack) {
		layer->OnUpdate();
	}

	// 层栈的渲染处理，由底层至顶层
	m_ImGuiLayer->BeginImGui();
	for (Layer* layer : m_LayerStack) {
		layer->OnRender();
	}
	m_ImGuiLayer->EndImGui();

	// 窗口的（事件等）逻辑更新处理，由顶层至底层
	m_AppWindow->OnUpdate();

}
```

三、sandbox使用imgui调用的问题

imgui编译为静态库.lib，后被Snail依赖；Snail编译为dll，后被sandbox依赖；在sandbox使用imgui会报错无法识别imgui符号（函数）。

原因是Snail内没有使用过imgui函数，编译dll的时候会优化掉没有使用过的符号。

**解决方法1：**在Snail使用符号，并使用

\_\_declspec(dllexport) & \_\_declspec(dllimport) 调用动态库内容

**解决方法2：**创建.def文件定义需要导出的函数。