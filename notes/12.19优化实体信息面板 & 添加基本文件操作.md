# 12.19优化实体信息面板 & 添加基本文件操作

## 1.优化实体信息面板

![屏幕截图 2025-12-19 162612](images\屏幕截图 2025-12-19 162612.png)

这里其实比较简单，当我们在面板中输出实体信息时，是要遍历实体的注册表的，这之中，其实就可以顺便获取model的所有meshes信息，进一步再获取每个mesh的所有textures信息，这时就可以类似视口一样，使用ImGui::Image绘制纹理的样子：

```
// 绘制图片
uint32_t textureId = texture->GetRendererId();

ImGui::Image((void*)(intptr_t)textureId, { 64.0f, 64.0f }, ImVec2(0, 1), ImVec2(1, 0), { 1,1,1,1 }, { 1,1,1,0.5f });
```

## 2.文件操作

这部分也不复杂，但是分为多个部分：

### 引入ImGuiFileDialog库：

这个库是一个专为ImGui构建的一个文件选择器库，可以使用类：

```
class FileSelecter {
public:
	// 封装打开对话框的逻辑
	static void Open(const std::string& key, const std::string& title, const std::string& filters) {
		IGFD::FileDialogConfig config;
		config.path = ".";

		ImGuiFileDialog::Instance()->OpenDialog(key, title, filters.c_str(), config);
	}

	// 封装处理结果的逻辑
	static void Handle(const std::string& key, std::function<void(const std::string&)> onConfirm) {
		if (ImGuiFileDialog::Instance()->Display(key, ImGuiWindowFlags_NoCollapse, { 750.0f, 500.0f })) {
			if (ImGuiFileDialog::Instance()->IsOk()) {
				std::string filePath = ImGuiFileDialog::Instance()->GetFilePathName();
				onConfirm(filePath); // 执行传入的回调逻辑
			}
			ImGuiFileDialog::Instance()->Close();
		}
	}
};
```

Open用于点击按钮时打开文件选择器；

Handle放在每个窗口的 ImGui.End() 之后，依据key来执行每个文件选取后的回调函数。

例如Model Import：

```
// 处理ModelImport回调
FileSelecter::Handle("ModelImportKey", [this](const std::string& path) {
	if (m_SelectedEntity) {
		auto shader = ShaderLibrary::Load("assets/shaders/Standard.glsl");
		auto model = std::make_shared<Model>(shader, path);
		m_SelectedEntity.AddComponent<ModelComponent>(model);
	}
	});
```

this允许lambda访问path，并设定使用path进行model的构造。

### 模型的导入：

- 内部图元导入：Model新增一个构造方法，不要求传入现成的vertices数据，而只要求一个图元类型，内部根据类型使用内置的数据来创建model；在点击按钮后，构造model并创建实体即可（这里不包括文件操作）。
- 外部模型导入：提供一个文件选择器，可以调用接收外部模型路径的model方法，点击按钮后，唤起文件选择器，选择文件后加载导入模型并构造model，再用model来创建实体。

### 场景操作：

目前添加了场景的保存和读取，其实就是场景的序列化和反序列化，只要在对应按钮按下时唤起文件选择器，依据不同的情况调用序列化和反序列化即可。

