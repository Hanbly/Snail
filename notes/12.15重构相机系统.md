# 12.15重构相机系统

## 一、分为编辑器相机和ECS相机

之前我们的相机架构是：

Camera类——持有fov、aspect、projectionMatrix等相机自身的属性；

CameraConreoller——持有相机位置、viewMatrix等相机的控制（外部）属性和方法。

由于ECS系统把Transform分离作为一个组件结构体（对于相机来说就是viewMatrix），而且EditorCamera不参与ECS，所以现在我们要重构：

Camera类——只持有**projectionMatrix**；

EditorCamera——持有相机全部**自身属性+控制属性+所有方法**，它就是一个全能的相机类；

SceneCamera——持有fov、aspect、projectionMatrix，它是专门为ECS构造的一个相机类，**它的外部属性完全由Transform组件控制**。

所以，编辑层持有一个EditorCamera，不创建任何相机实体；应用层（现在还没有）只创建相机实体，不能直接操作它的外部属性，也就是不能直接控制相机。

## 二、编辑器相机支持FPS/Arcball两种相机模式

### 区别

fps模式是通过键盘控制移动，鼠标控制视角，用欧拉角原理，有万向节死锁缺陷，通过滚轮缩放能够调节相机fov，会拉伸镜头（会产生畸变）（好像在fps游戏中没有提供缩放的功能的）；

arcball模式是一般的建模软件采取的模式，与fps模式不同在于：采用**相机位置+注视点**的模式，由鼠标控制**相机的平移 & 绕视点旋转**，滚轮能够调节**相机位置和注视点的距离**（不会产生畸变）。

### arcball实现原理

实现原理相对复杂，arcball采用了四元数控制相机的绕点旋转，我并没理解，可以贴出ai的解释：

![屏幕截图 2025-12-21 103349](images\屏幕截图 2025-12-21 103349.png)

![屏幕截图 2025-12-21 103400](images\屏幕截图 2025-12-21 103400.png)

![屏幕截图 2025-12-21 103418](images\屏幕截图 2025-12-21 103418.png)

